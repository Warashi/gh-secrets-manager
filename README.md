# gh-secrets-manager

`gh-secrets-manager` is a CLI tool for encrypting and managing GitHub Actions secrets for multiple repositories. It is designed to be used together with Terraform's [`github_actions_secret`](https://registry.terraform.io/providers/integrations/github/latest/docs/resources/actions_secret) resource.

## Features

- Encrypts secrets for each GitHub repository and stores them in a local JSON file
- Add (set), rotate, and delete secrets
- Uses the [GitHub CLI Go SDK](https://github.com/cli/go-gh)
- Integrates with Terraform's `github_actions_secret` resource

## Example: Integration with Terraform

You can use the `secrets.json` generated by this tool with Terraform's `github_actions_secret` resource.

```hcl
locals {
  secrets = jsondecode(file("secrets.json")).secrets
}

resource "github_actions_secret" "example" {
  for_each        = { for s in local.secrets : "${s.owner}/${s.repository}/${s.name}" => s }
  repository      = each.value.repository
  secret_name     = each.value.name
  encrypted_value = each.value.encrypted_secret
}
```

For more details, see the [Terraform documentation](https://registry.terraform.io/providers/integrations/github/latest/docs/resources/actions_secret).

## Installation

### Install as a GitHub CLI Extension

You can install `gh-secrets-manager` as a GitHub CLI extension:

```sh
gh extension install Warashi/gh-secrets-manager
```

### Prerequisites
- Go 1.24 or later
- Authenticated with GitHub CLI (`gh auth login`)

### Build from Source

```sh
go build -o gh-secrets-manager main.go
```

## Usage

```sh
gh-secrets-manager set --file <file> --owner <owner> --repository <repo> --name <name> --env <ENV_VAR>
gh-secrets-manager rotate --file <file> --env <ENV_VAR>
gh-secrets-manager delete --file <file> --owner <owner> --repository <repo> --name <name>
```

### Command Examples

#### Add a Secret

```sh
gh-secrets-manager set --file secrets.json --owner myorg --repository myrepo --name SECRET_NAME --env MY_SECRET_ENV
```

#### Rotate Secrets

```sh
gh-secrets-manager rotate --file secrets.json --env MY_SECRET_ENV
```

#### Delete a Secret

```sh
gh-secrets-manager delete --file secrets.json --owner myorg --repository myrepo --name SECRET_NAME
```

## Format of secrets.json

```json
{
  "version": 1,
  "secrets": [
    {
      "owner": "myorg",
      "repository": "myrepo",
      "name": "SECRET_NAME",
      "encrypted_secret": "<base64>",
      "env": "MY_SECRET_ENV",
      "added_at": "2024-06-01T00:00:00Z",
      "updated_at": "2024-06-01T00:00:00Z"
    }
  ]
}
```

## Development

### Dependencies
- [github.com/cli/go-gh/v2](https://github.com/cli/go-gh)
- [golang.org/x/crypto/nacl/box](https://pkg.go.dev/golang.org/x/crypto/nacl/box)

Install dependencies:

```sh
go mod tidy
```

### Release

Releases are automated by GitHub Actions when a tag (`v*`) is pushed. See `.github/workflows/release.yml` for details.

## License

MIT
